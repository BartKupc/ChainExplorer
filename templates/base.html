<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}Block Explorer{% endblock %}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #f5f5f5; }
        .navbar { background: #2c3e50; color: white; padding: 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .nav-container { max-width: 100%; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .nav-brand { font-size: 1.5em; font-weight: bold; padding: 15px 20px; }
        .nav-menu { display: flex; list-style: none; margin: 0; padding: 0; }
        .nav-item { margin: 0; align-items: center;}
        .nav-link { color: white; text-decoration: none; padding: 20px 1px; display: block; transition: background 0.2s ease; }
        .nav-link:hover { background: #34495e; }
        .nav-link.active { background: #3498db; }
        .nav-right { display: flex; align-items: center; gap: 15px; }
        .chain-selector { margin: 0; }
        .chain-selector select { padding: 8px; border-radius: 4px; border: 1px solid #ddd; background: white; color: #333; }
        .search-form { display: flex; gap: 8px; }
        .search-input { padding: 8px; border-radius: 4px; border: 1px solid #ddd; min-width: 250px; }
        .search-button { padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .search-button:hover { background: #2980b9; }
        .main-content { padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .box { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header { background: #2c3e50; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .error-box { background: #ffebee; border: 1px solid #f44336; color: #c62828; }
        .info-row { display: flex; justify-content: space-between; margin: 8px 0; padding: 8px 0; border-bottom: 1px solid #eee; }
        .label { font-weight: bold; color: #555; }
        .value { color: #333; font-family: monospace; }
        .hash { color: #e74c3c; }
        .number { color: #3498db; font-size: 1.2em; }
        .chain-info { background: #e3f2fd; border: 1px solid #2196f3; color: #1565c0; }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="{{ url_for('home', chain=current_chain) }}" style="color: white; text-decoration: none;">Chain Explorer</a>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="{{ url_for('home', chain=current_chain) }}" class="nav-link {% if request.endpoint == 'home' %}active{% endif %}">Home</a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('block_page', ref='latest', chain=current_chain) }}" class="nav-link {% if request.endpoint == 'block_page' %}active{% endif %}">Blocks</a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('all_blocks', chain=current_chain) }}" class="nav-link {% if request.endpoint == 'all_blocks' %}active{% endif %}">All Blocks</a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('searchfor', chain=current_chain) }}" class="nav-link {% if request.endpoint == 'searchfor' %}active{% endif %}">ERC20 Search</a>
                </li>

            </ul>
            
            <div class="nav-right">
                <!-- Chain Selector -->
                <div class="chain-selector">
                    <select onchange="changeChain(this.value)">
                        {% for key, chain in CHAINS.items() %}
                        <option value="{{ key }}" {% if key == current_chain %}selected{% endif %}>
                            {{ key }}
                        </option>
                        {% endfor %}
                    </select>
                    <div class="chain-buttons">
                        <a href="{{ url_for('manage_chains', chain=current_chain) }}" class="chain-btn add-btn" title="Manage Chains">Manage Chains</a>
                    </div>
                </div>
                
                <!-- Search Form -->
                <form action="{{ url_for('search') }}" method="get" class="search-form">
                    <input type="hidden" name="chain" value="{{ current_chain }}">
                    <input name="q" placeholder="Block #, tx hash, address" class="search-input" required>
                    <button type="submit" class="search-button">Quick Search</button>
                </form>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        {% block content %}{% endblock %}
    </div>
    
    <script>
        function changeChain(newChain) {
            // Get current URL and path
            const currentUrl = window.location.href;
            const url = new URL(currentUrl);
            
            // Update the chain parameter
            url.searchParams.set('chain', newChain);
            
            // Redirect to the same page with new chain
            window.location.href = url.toString();
        }
        
        // Navigation loading widget
        document.addEventListener('DOMContentLoaded', function() {
            // Add click handlers to all navigation links
            const navLinks = document.querySelectorAll('.nav-link-with-loading');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // Show loading widget on current page before navigation
                    const currentLoadingWidget = document.getElementById('loading-widget');
                    const currentContentContainer = document.getElementById('content-container');
                    
                    if (currentLoadingWidget && currentContentContainer) {
                        // Show loading widget immediately
                        currentLoadingWidget.style.display = 'flex';
                        currentContentContainer.style.display = 'none';
                        
                        // Add a small delay to ensure loading widget is visible
                        setTimeout(() => {
                            // Continue with navigation
                            window.location.href = this.href;
                        }, 100);
                    }
                });
            });
        });
    </script>
</body>
</html>
